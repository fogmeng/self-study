### 1.  SSL/TLS概述

	#### 1.1 SSL/TLS协议提供的服务

* 身份验证：认证用户和服务器，确保数据发送到正确的客户机和服务器。通过CA的证书。
* 加密：加密数据防止数据被中途窃取。通过RSA加密，
* 消息完整性校验：维护数据的完整性，确保数据中在传输中不被篡改。-- 通过数字签名-摘要算法

#### 1.2 数字签名的作用

* 证明是作者编写的报文。
* 可以防止报文被篡改。

#### 1.3 身份的验证过程

* 客户端向服务端发起请求。
* 服务端将CA发给自己的证书发给客户端。
* 客户端在本机查找该CA是否在本机CA列表中。
* 如果存在，客户端使用该CA的公钥对证书的上CA数字签名进行验证。
* 如果验证通过，说明该证书确实是CA颁发的。
* 查看证书是否在有效期内，证书信息是否与当前域名一致。
* 如果一致，说明证书是该服务器所有。

#### 1.4 加密

* TLS需要解决的问题是 安全交换秘钥和使用对称加密对数据进行加密。
* 加密技术有2种：对称加密和非对称加密。
* 对称秘钥加密：DES、3-DES、RC2、RC4和AES。
* 非对称秘钥加密：RSA。

|  加密技术  |                 优点                 |         缺点         |        用处        |
| :--------: | :----------------------------------: | :------------------: | :----------------: |
|  对称秘钥  |        加解密速度快，性能好。        | 秘钥交换有泄露风险。 |   加密传输的数据   |
| 非对称秘钥 | 秘钥交换没有泄露风险，可用多数字签名 |        性能差        | 身份验证和密钥交换 |

* TLS使用公钥加密对服务器进行身份验证后，在客户端和服务端之间确定对称秘钥。
* 随后使用商定的对称秘钥加密会话中的大量数据。
* 这种方案既利用非对称加密解决了身份验证和秘钥交换问题。
* 又结合了对称加密加密大量数据速度快的优点。

### 2. 安全会话建立过程

#### 2.1 客户端先发送消息启动握手

	##### 	client hello

​	客户端向服务器发送client hello 以发起会话，信息如下：

 *        __版本号__，客户端支持的最高版本协议。
 *        __随机数__,长度32字节的随机数，4字节的客户端时间+28字节的随机数。
 *        **sessionID**,sessionID用来恢复之前会话。创建新的安全会话，需要处理器进行密集计算得到会话秘钥。通过       seesionID可以解决该问题。
 *        **加密套装** 客户端支持的加密套装列表。例如TLS_RSA_WITH_DEC_CBC_SHA, TLS是协议版本，RSA是非对称加密算法，DEC_CBC是加密算法，SHA是散列算法。、

#### 2.2 服务器响应

####       server hello

​	服务端向客户端发送client hello的信息：

* **版本号**

* **随机数** 服务端随机数，由服务器时间+随机数组成。与客户端随机数一起生成==master key==。==master key==用来生成会话秘钥。

* **sessionID** 用来恢复会话，有3中情况：

  * 新sessionID,客户端没有指明sessionID,服务端返回一个新的sessionID。如果客户端指明了sessionID,但是服务端无法恢复对应会话，则重新生成一个sessionID。
  * 恢复的sessionID。客户端指明恢复sessionID,同时服务端可以恢复该会话。
  * 无。是新的会话，但服务器不希望将来恢复该会话，所以不返回sessionID。

* **加密套装** 服务器选择一个服务端和客户端都支持的加密套装。

* **压缩算法** 指定压缩算法。

  下面是一个server hello的例子：

  ```java
  Version 3,1
  ServerRandom[32]
  SessionID: bd608869f0c629767ea7e3ebf7a63bdcffb0ef58b1b941e6b0c044acb6820a77
  Use Cipher Suite:
  TLS_RSA_WITH_3DES_EDE_CBC_SHA
  Compression Algorithm: NONE
  ```

  

  ####  Server Certificate

* 服务器向客户端发送证书。服务器证书包含了服务器公钥，客户端使用服务器的公钥验证服务器身份对==primasterkey==加密。

* 客户端还会检查证书上声明的域名，该域名必须与服务器使用的域名匹配。



https://segmentfault.com/a/1190000015709520







